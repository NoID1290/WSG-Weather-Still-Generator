# WSG - Weather Still Generator

> Automated weather image and video generation system for displaying current conditions, forecasts, and weather alerts

![Build Status](https://img.shields.io/badge/build-passing-brightgreen) ![License](https://img.shields.io/badge/license-MIT-blue) ![.NET Version](https://img.shields.io/badge/.NET-8.0-purple)

## ğŸ“‹ Overview

**WSG (Weather Still Generator)** is a comprehensive weather visualization application that automatically generates high-quality still images and MP4 videos displaying current weather conditions, forecasts, and alerts. Perfect for digital signage, weather stations, streaming overlays, or information displays.

The system continuously fetches weather data, processes it into beautiful images, and can compile them into slideshow videos with configurable transitions and background music.

## âœ¨ Features

- **ğŸ“Š Multiple Image Types**
  - Current weather conditions (temperature, humidity, wind speed)
  - Daily forecasts (high/low temperatures, conditions)
  - Detailed weather analysis (pressure, wind direction)
  - Location-based weather maps with city overlays
  - Temperature watermark overlays
  - Weather alerts from Environment Canada

- **ğŸ¬ Video Generation**
  - MP4 slideshow creation with FFmpeg
  - Configurable fade transitions
  - Custom static duration per image
  - Multiple resolution modes (1080p, 4K, Vertical)
  - Background music integration
  - Customizable frame rates

- **ğŸš¨ Alert System**
  - Real-time Environment Canada weather alerts
  - Color-coded severity (Red/Yellow/Gray)
  - Automatic alert categorization (Warning/Watch/Statement)
  - Multi-city alert aggregation

- **âš™ï¸ Highly Configurable**
  - JSON-based configuration (no recompile needed)
  - Customizable locations, fonts, colors
  - Adjustable refresh intervals
  - Dynamic image dimensions
  - Flexible output paths

- **ğŸ”„ Automated Updates**
  - Continuous operation with configurable update cycles
  - Reliable error handling and retry logic
  - Console logging for monitoring
  - Cross-platform compatibility (Windows/.NET 8.0)

## ğŸ—ï¸ Project Structure

```
weather-still-api/
â”œâ”€â”€ WeatherImageGenerator/          # Main application
â”‚   â”œâ”€â”€ Program.cs                  # Entry point & main logic
â”‚   â”œâ”€â”€ ConfigManager.cs            # Configuration system
â”‚   â”œâ”€â”€ ECCC.cs                     # Environment Canada integration
â”‚   â”œâ”€â”€ VideoGenerator.cs           # MP4 video creation
â”‚   â”œâ”€â”€ appsettings.json            # Configuration file
â”‚   â”œâ”€â”€ CONFIG_README.md            # Configuration documentation
â”‚   â””â”€â”€ WeatherImageGenerator.csproj
â”œâ”€â”€ OpenMeteo/                      # Weather API library
â”‚   â”œâ”€â”€ OpenMeteoClient.cs          # API client wrapper
â”‚   â””â”€â”€ *.cs                        # Domain models
â””â”€â”€ OpenMeteoTests/                 # Unit tests
```

## ğŸš€ Quick Start

### Prerequisites

- **.NET 8.0 SDK** or later
- **FFmpeg** (for video generation)
- **Internet connection** (for weather data and alerts)
- **Windows** (System.Drawing.Common dependency)

### Installation

1. **Clone the repository**
   ```bash
   git clone https://github.com/yourusername/weather-still-api.git
   cd weather-still-api
   ```

2. **Install dependencies**
   ```bash
   # Restore NuGet packages
   dotnet restore
   ```

3. **Build the project**
   ```bash
   cd WeatherImageGenerator
   dotnet build -c Release
   ```

4. **Verify FFmpeg** (for video generation)
   ```bash
   ffmpeg -version
   ```
   If not installed, download from [ffmpeg.org](https://ffmpeg.org/download.html)

### Running the Application

```bash
# Debug mode
dotnet run

# Release mode
dotnet run -c Release

# From working directory
./WeatherImageGenerator.exe
```

The application will:
1. Load configuration from `appsettings.json`
2. Fetch weather for all configured locations
3. Generate images in the `WeatherImages/` folder
4. Create videos if configured
5. Wait for the refresh interval and repeat

## ğŸ“ Configuration

All settings are managed in **`appsettings.json`** without requiring recompilation.

### Key Configuration Sections

```json
{
  "Locations": {
    "Location0": "MontrÃ©al",
    "Location1": "Saint-RÃ©mi",
    ...
  },
  "RefreshTimeMinutes": 10,
  "ImageGeneration": {
    "ImageWidth": 1920,
    "ImageHeight": 1080,
    "FontFamily": "Arial"
  },
  "Video": {
    "StaticDurationSeconds": 8,
    "FrameRate": 30,
    "ResolutionMode": "Mode1080p"
  },
  "ECCC": {
    "CityFeeds": { ... }
  }
}
```

ğŸ‘‰ **See [CONFIG_README.md](./CONFIG_README.md) for complete configuration documentation**

## ğŸ“¸ Output Files

The application generates images in the `WeatherImages/` folder:

| File | Purpose | Generated By |
|------|---------|--------------|
| `1_CurrentWeather.png` | Current conditions display | GenerateCurrentWeatherImage() |
| `2_DailyForecast.png` | Daily forecast summary | GenerateForecastSummaryImage() |
| `3_DetailedWeather.png` | Detailed weather analysis | GenerateDetailedWeatherImage() |
| `4_WeatherMaps.png` | Location-based weather map | GenerateMapsImage() |
| `6_WeatherAlerts.png` | Environment Canada alerts | GenerateAlertsImage() |
| `temp_watermark_alpha.png.IGNORE` | Temperature watermark | GenerateAPNGcurrentTemperature() |
| `slideshow_v3.mp4` | Video slideshow | VideoGenerator |

## ğŸ”§ How It Works

### Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  appsettings    â”‚
â”‚   .json         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ConfigManager loads config â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fetch Weather Data                  â”‚
â”‚  - OpenMeteo API (7 locations)       â”‚
â”‚  - ECCC RSS Feeds (alerts)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generate Still Images               â”‚
â”‚  - Current weather                   â”‚
â”‚  - Forecasts                         â”‚
â”‚  - Maps                              â”‚
â”‚  - Alerts                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generate Video (Optional)           â”‚
â”‚  - Compile images into MP4           â”‚
â”‚  - Add fade transitions              â”‚
â”‚  - Add background music              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Output to WeatherImages/ folder     â”‚
â”‚  - PNG images ready for display      â”‚
â”‚  - MP4 video for streaming           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         v
    [Wait & Repeat]
```

### Main Components

#### **Program.cs**
- Application entry point
- Main update loop and orchestration
- Image generation methods
- Weather data fetching

#### **ConfigManager.cs**
- Loads and caches JSON configuration
- Provides strongly-typed config objects
- Handles validation and errors

#### **ECCC.cs**
- Fetches Environment Canada weather alerts
- Parses RSS feeds for multiple cities
- Categorizes alert types and severity

#### **VideoGenerator.cs**
- Creates MP4 videos from images
- Configurable transitions and timing
- FFmpeg integration

#### **OpenMeteoClient.cs** (External)
- Queries Open-Meteo weather API
- Returns current conditions and forecasts
- No API key required

## ğŸ¯ Use Cases

- **Digital Signage** - Display weather in offices, stores, venues
- **Live Streaming** - Weather overlay for streaming broadcasts
- **Weather Stations** - Local weather information displays
- **Educational Tools** - Weather data visualization and learning
- **News Broadcasts** - Weather segment video generation
- **Smart Displays** - Network-connected weather information

## ğŸ“Š Supported Data

### Current Weather
- Temperature
- Humidity
- Wind speed & direction
- Surface pressure
- Weather conditions (clear, cloudy, rainy, etc.)

### Forecasts
- Daily high/low temperatures
- Weather conditions
- Multi-day outlook

### Alerts
- Environment Canada warnings
- Weather watches
- Weather statements
- Severity levels and color coding

### Locations
- Configurable (default: 7 Quebec cities)
- Geographic coordinates for alerts
- Multiple data sources

## ğŸ”Œ API Dependencies

### Open-Meteo (Free Weather API)
- **Endpoint:** `https://api.open-meteo.com/v1/forecast`
- **Features:** Current weather, hourly, daily forecasts
- **Key Required:** No
- **Rate Limit:** 10,000 calls/day (generous)
- **Docs:** [open-meteo.com](https://open-meteo.com)

### Environment Canada (RSS Feeds)
- **Feeds:** City-specific weather alert RSS
- **Format:** XML (parsed as Atom feeds)
- **Politeness Delay:** 200ms between requests
- **User-Agent:** Required (included in config)

## âš™ï¸ System Requirements

| Requirement | Minimum | Recommended |
|------------|---------|-------------|
| OS | Windows 7+ | Windows 10+ |
| .NET | 8.0 | Latest |
| RAM | 256 MB | 512 MB+ |
| Disk Space | 100 MB | 500 MB+ |
| CPU | Any modern | Multi-core |
| Network | Broadband | 10+ Mbps |

## ğŸ“‹ Command Line

```bash
# Run with default configuration
dotnet run

# Run in release mode
dotnet run -c Release

# Build only
dotnet build

# Clean and rebuild
dotnet clean && dotnet build

# Run tests
dotnet test
```

## ğŸ› Troubleshooting

### Application Won't Start
- Verify `.NET 8.0` is installed: `dotnet --version`
- Check `appsettings.json` exists and is valid JSON
- Ensure `WeatherImages/` folder has write permissions

### Images Not Generating
- Check internet connection (for weather API)
- Verify location names are valid
- Review console output for specific errors
- Check disk space in `WeatherImages/` folder

### Video Generation Fails
- Verify FFmpeg is installed: `ffmpeg -version`
- Check music file exists if configured
- Ensure output file path is writable
- Review FFmpeg logs in console output

### Alerts Not Appearing
- Check ECCC RSS feed URLs are valid
- Verify network connectivity
- Check for active alerts in the configured cities
- Review ECCC feed configuration in `appsettings.json`

### Configuration Not Applying
- **Restart the application** (config is loaded at startup)
- Verify JSON syntax is valid
- Check file permissions on `appsettings.json`
- Look for error messages in console output

## ğŸ“¦ Dependencies

### NuGet Packages
- **OpenMeteo** - Weather API client
- **System.Drawing.Common** - Image generation
- **System.Net.Http** - HTTP requests
- **System.Text.Json** - JSON parsing
- **System.Xml.Linq** - XML/RSS parsing

### External Tools
- **FFmpeg** - Video encoding and MP4 creation

## ğŸ¤ Contributing

Contributions welcome! Areas for enhancement:
- Additional weather data sources
- More image layout templates
- Enhanced alert visualization
- Performance optimization
- Cross-platform support improvements

## ğŸ“„ License

MIT License - See LICENSE file for details

## ğŸ†˜ Support

### Debug Mode
Run with console output for detailed logging:
```bash
dotnet run
```

### Log Output
The application logs to console with timestamps and status indicators:
- `âœ“` - Success
- `âœ—` - Error/Failure
- `---` - Section separators

### Common Issues
See [CONFIG_README.md](./CONFIG_README.md) troubleshooting section

## ğŸ—“ï¸ Changelog

### v1.0 (Current)
- âœ… Configuration system implementation
- âœ… Multi-location weather fetching
- âœ… Image generation (6 types)
- âœ… Video slideshow creation
- âœ… Environment Canada alerts integration
- âœ… Continuous operation with configurable intervals

## ğŸ‘¨â€ğŸ’» Author

**Weather Still Generator** - Automated weather visualization system

---

**Last Updated:** December 12, 2025  
**Version:** 1.0  
**Status:** Active & Maintained
